<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="userSql">

	<!-- 유저 추가 -->
	<insert id="putUser" parameterType="com.dongkeonoh.toybox.vo.UserVo">
		INSERT INTO TB_USER 
        VALUES 
     		 (
       		   #{usr_id},
       		   #{usr_password},
       		   #{usr_name},
		<choose>
			<when test='usr_image != null and usr_image != ""'>
       		   #{usr_image},
			</when>
			<otherwise>
				DEFAULT,
			</otherwise>
		</choose>
       		   #{usr_sms},
       		   #{usr_kakao},
       		   'N',
       		   #{usr_question},
       		   #{usr_answer}
     		 )
	</insert>
	
	<!-- 유저 수정 -->
	<update id='modifyUser' parameterType="com.dongkeonoh.toybox.vo.UserVo">
		UPDATE tb_user 
		   SET USR_ID = #{usr_id}
		<if test='usr_password != null and usr_password != ""'>
		   	   USR_PASSWORD = #{usr_password},
		</if>
		<if test='usr_image != null and usr_image != ""'>
    		   USR_IMAGE = #{usr_image},
		</if>
		<if test='usr_sms != null and usr_sms != ""'>
    		   USR_SMS = #{usr_sms},
		</if>
		<if test='usr_kakao != null and usr_kakao != ""'>
    	 	   USR_KAKAO = #{usr_kakao}
		</if>
    	 WHERE USR_ID = #{usr_id}
	</update>
	
	<!-- 유저 active -->
	<update id='activeUser' parameterType="com.dongkeonoh.toybox.vo.UserVo">
		UPDATE tb_user 
		   SET USR_ACTIVE = #{usr_active}
    	 WHERE USR_ID = #{usr_id}
	</update>
	
	<!-- 유저 삭제 -->
	<delete id='deleteUser' parameterType="com.dongkeonoh.toybox.vo.UserVo">
		DELETE 
		  FROM TB_USER 
		  WHERE USR_ID = #{usr_id}
	</delete>

	<!-- 유저 보기 -->
	<select id="getUser" resultType="com.dongkeonoh.toybox.vo.UserVo" parameterType="String">
		SELECT USR_ID
		     , USR_NAME
		     , USR_IMAGE
		     , USR_SMS
		     , USR_KAKAO
       		 , USR_QUESTION
       		 , USR_ANSWER
		  FROM TB_USER
		 WHERE USR_ID = #{usr_id}
	</select>	
	
	<!-- 유저 목록 조회 -->
	<select id="listUser" parameterType="HashMap" resultType="com.dongkeonoh.toybox.vo.UserVo">
		SELECT USR_ID
		     , USR_NAME
		     , USR_IMAGE
		     , USR_SMS
		     , USR_KAKAO
		     , USR_ACTIVE
             , CNT
 		 FROM
			(
			  SELECT ROWNUM AS RN
			  	   , A.*
			  	FROM
			  	   (
			  	   	 SELECT USR_ID
					      , USR_NAME
					      , USR_IMAGE
					      , USR_SMS
					      , USR_KAKAO
					      , USR_ACTIVE
	             	      , COUNT(USR_ID) OVER() CNT
			  	       FROM TB_USER
			 	      WHERE 1=1
<!-- 				<choose> -->
<!-- 					<when test="keytype != null and keytype.equals('group')"> -->
<!-- 					    AND CGR_GROUP LIKE '%'||#{keyword}||'%' -->
<!-- 					</when> -->
<!-- 					<when test="keytype != null and keytype.equals('name')"> -->
<!-- 					    AND CGR_GROUP_NAME LIKE '%'||#{keyword}||'%' -->
<!-- 					</when> -->
<!-- 				</choose> -->
			  	   ) A
			   WHERE ROWNUM <![CDATA[<=]]> #{end_idx}	  
			)
		WHERE RN <![CDATA[>=]]> #{start_idx} 
	</select>
	
	<!-- 공통코드 보기 (임시) -->
	<select id="getComCode" resultType="com.dongkeonoh.toybox.vo.CommonVo" parameterType="String">
		SELECT CCD_SEQ      
			 , CCD_CODE     
			 , CCD_GROUP    
			 , CCD_CODENAME 
			 , CCD_DETAIL1  
			 , CCD_DETAIL2  
			 , CCD_DETAIL3  
			 , CCD_NOTE     
			 , CCD_ORDER    
			 , CCD_USEYN 
		  FROM TB_COMMON_CODE
		 WHERE CCD_GROUP = #{group}
	</select>
</mapper>

