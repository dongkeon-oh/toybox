<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="commonSql">
	
	<!-- 공통코드 그룹 추가 -->
	<insert id="putCommonGroup" parameterType="com.dongkeonoh.toybox.vo.CommonVo">
		INSERT INTO TB_COMMON_GROUP
			 (
			   CGR_GROUP,
			   CGR_GROUP_NAME,
			   CGR_NOTE,
			   CGR_USEYN
			 )
        VALUES 
     		 (
       		   #{cgr_group},
       		   #{cgr_group_name},
       		   #{cgr_note},
       		   'Y'
     		 )
	</insert>

	<!-- 공통코드 그룹 수정 -->
	<update id="modifyCommonGroup" parameterType="com.dongkeonoh.toybox.vo.CommonVo">
		UPDATE TB_COMMON_GROUP
		   SET CGR_GROUP_NAME = #{cgr_group_name},
			   CGR_NOTE = #{cgr_note}
		 WHERE CGR_GROUP = #{cgr_group}
	</update>
	
	<!-- 공통코드 그룹 수정 -->
	<update id="deleteCommonGroup" parameterType="com.dongkeonoh.toybox.vo.CommonVo">
		UPDATE TB_COMMON_GROUP
		   SET CGR_USEYN = 'N'
		 WHERE CGR_GROUP = #{cgr_group}
	</update>
	
	<!-- 공통코드 그룹 목록 조회 -->
	<select id="dupCommonGroup" parameterType="com.dongkeonoh.toybox.vo.CommonVo" resultType="int">
		SELECT COUNT(CGR_GROUP) AS CGR_GROUP
		  FROM TB_COMMON_GROUP
		 WHERE 1=1
		   AND CGR_GROUP = #{cgr_group}
	</select>
	
	<!-- 공통코드 그룹 목록 조회 -->
	<select id="listCommonGroup" parameterType="HashMap" resultType="com.dongkeonoh.toybox.vo.CommonVo">
		SELECT CGR_GROUP
			 , CGR_GROUP_NAME
		     , CGR_NOTE 
             , CGR_USEYN
             , CNT
 		 FROM
			(
			  SELECT ROWNUM AS RN
			  	   , A.*
			  	FROM
			  	   (
			  	   	 SELECT CGR_GROUP
				 	      , CGR_GROUP_NAME
			              , CGR_NOTE 
	             	      , CGR_USEYN
	             	      , COUNT(CGR_GROUP) OVER() CNT
			  	       FROM TB_COMMON_GROUP
			 	      WHERE 1=1
				<choose>
					<when test="keytype != null and keytype.equals('group')">
					    AND CGR_GROUP LIKE '%'||#{keyword}||'%'
					</when>
					<when test="keytype != null and keytype.equals('name')">
					    AND CGR_GROUP_NAME LIKE '%'||#{keyword}||'%'
					</when>
				</choose>
			  	   ) A
			   WHERE ROWNUM <![CDATA[<=]]> #{end_idx}	  
			)
		WHERE RN <![CDATA[>=]]> #{start_idx} 
	</select>
	
	<!-- 공통 코드 -->	
	<!-- 공통코드 그룹 추가 -->
	<insert id="putCommonCode" parameterType="com.dongkeonoh.toybox.vo.CommonVo">
		INSERT INTO TB_COMMON_CODE
			 (
			   CCD_SEQ,      
			   CCD_CODE,     
			   CCD_GROUP,    
			   CCD_CODENAME, 
			   CCD_DETAIL1,  
			   CCD_DETAIL2,  
			   CCD_DETAIL3,  
			   CCD_NOTE,     
			   CCD_ORDER,    
			   CCD_USEYN 
			 )
        VALUES 
     		 (
			   SEQ_COMMON_ID.NEXTVAL,      
			   #{ccd_code},     
			   #{ccd_group},    
			   #{ccd_codename}, 
			   #{ccd_detail1},  
			   #{ccd_detail2},  
			   #{ccd_detail3},  
			   #{ccd_note},     
			   #{ccd_order},
       		   'Y'
     		 )
	</insert>   
	
	<!-- 공통 코드 조회 -->
	<select id="listCommonCode" parameterType="com.dongkeonoh.toybox.vo.CommonVo" resultType="com.dongkeonoh.toybox.vo.CommonVo">
	SELECT CCD_SEQ
	     , CCD_CODE
	     , CCD_GROUP
	     , CCD_CODENAME
	     , CCD_DETAIL1
	     , CCD_DETAIL2
	     , CCD_DETAIL3
	     , CCD_NOTE
	     , CCD_ORDER
	     , CCD_USEYN
	  FROM TB_COMMON_CODE
	 WHERE CCD_GROUP = #{cgr_group}
	 ORDER BY CCD_SEQ
	</select>
</mapper>

